# kong ì¸ì¦ì— ê´€í•´

> Kong API GatewayëŠ” OAuth 2.0, JWT, Basic Auth, Key Authentication ë“± ë‹¤ì–‘í•œ ì¸ì¦ ë°©ì‹ì„ ì§€ì›í•©ë‹ˆë‹¤.
í´ë¼ì´ì–¸íŠ¸ê°€ API ìš”ì²­ì„ ë³´ë‚¼ ë•Œ, Kongì´ ì¸ì¦ ì ˆì°¨ë¥¼ ìˆ˜í–‰í•˜ëŠ” ê³¼ì •ì„ __JWT__ í† í° ê¸°ë°˜ ì¸ì¦ì„ ì˜ˆì œ

## kongì— JWT í”ŒëŸ¬ê·¸ì¸ í™œì„±í™”
<pre>
POST http://localhost:8001/services/user-service/plugins
Content-Type: application/json
<code>
{
  "name": "jwt",
  "config": {
    "key_claim_name": "iss",
    "secret_is_base64": false
  }
}
</code>
</pre>

## 1. ì¸ì¦ ê³¼ì •
```plaintext

1. ì¸ì¦ìš”ì²­
+-----------+        +-----------------+        +-----------------+
|  Client   | -----> |      Kong       | -----> |    Auth Server  |
+-----------+        +-----------------+        +-----------------+
                 |                        |              |
                 v                        v              v
            ì‚¬ìš©ì ìš”ì²­            ì¸ì¦ ì •ë³´ ìš”ì²­      access_token ë°œê¸‰
          (ID/PWD ë¡œê·¸ì¸)

2. ì´í›„ API í˜¸ì¶œ >  JWT í”ŒëŸ¬ê·¸ì¸ì—ì„œ ì¸ì¦ìˆ˜í–‰ > ì¸ì¦ ì„±ê³µì´ë©´ kongì—ì„œ Backend Service í˜¸ì¶œ
                     +--------------------------------------------+
+-----------+        |                          +-----------------+        +-------------------+
|  Client   | -----> |      Kong  ------------> |    JWT í”ŒëŸ¬ê·¸ì¸  | -----> |  Backend Service  |
+-----------+        |                          +-----------------+        +-------------------+
                     +--------------------------------------------+
                 |                                        |
                 v                                        v
            ë°œê¸‰ë°›ì€ access_token ì ìš©            1. JWT í† í° Base64 ë””ì½”ë”© 2. ì„œëª…ê²€ì¦
          "Authorization" í—¤ë”ì— í¬             3. ìœ íš¨ê¸°ê°„(exp)ê²€ì¦ 4.ë°œê¸‰ì(lss) ê²€ì¦ 5.Audience(aud) ê²€ì¦

3. Backend Service ê²°ê³¼ê°’ì„ kongì„ ê±°ì²˜ Clientë¡œ ë°˜í™˜
```

## 2. OAuth2.0ì„ ì´ìš©í•œ ì¸ì¦ ì˜ˆì‹œ(ì‡¼í•‘ëª° í™ˆí˜ì´ì§€)
```plaintext

1. íšŒì›ê°€ì… (ì˜ˆ. /member/oauth2)
+-----------+        +--------------------+             +-----------------+             +-----------------+
|  Client   | -----> |        Kong        | ----------> | ì‡¼í•‘ëª°-íšŒì›ê°€ì…  | ----------> |    OAuth 2.0    |
+-----------+        +--------------------+             +-----------------+             +-----------------+
                |                                                               |                |
                v                                                               v                v
          ì‚¬ìš©ì ê°€ì… ìš”ì²­                                              ê°€ì… í›„ OAuth       client_id, client_secret
                                                                       ìê²©ì¦ëª…ìš”ì²­       ìƒì„± í›„ DB ì €ì¥
          

2. ë¡œê·¸ì¸ ì‹œ Authorization Code ë°œê¸‰ (ì˜ˆ. /oauth2/authorize)
                              +--------------------------------------------------------------------+
                              |                                                                    |
+-----------+        +--------------------+             +-----------------+                +-----------------+
|  Client   | -----> |        Kong        | ----------> | ì‡¼í•‘ëª° ë¡œê·¸ì¸    | -------------> |    OAuth 2.0    |
+-----------+        +--------------------+             +-----------------+                +-----------------+
                 |                                                               |                  |
                 v                                                               v                  v
              ë¡œê·¸ì¸                                                       id/pwd í™•ì¸ í›„        í™•ì¸í›„ ìŠ¹ì¸í•˜ë©´ 
                                                                          client_idì¸ì¦ ìš”ì²­     Authorization Code ë°œê¸‰.

3. Access Token ë°œê¸‰ (ì˜ˆ. /oauth2/token)
+-----------+        +--------------------+             +-----------------+
|  Client   | -----> |        Kong        | ----------> |  OAuth 2.0      |
+-----------+        +--------------------+             +-----------------+
                 |                               |                  |
                 v                               v                  v
              ë¡œê·¸ì¸                    Authorization Codeë¡œ    í™•ì¸í›„ ìŠ¹ì¸í•˜ë©´ 
                                          Access Token ìš”ì²­   Access_token ë°œê¸‰.

4. ì´í›„ API í˜¸ì¶œ >  OAuth2.0 í”ŒëŸ¬ê·¸ì¸ì—ì„œ ì¸ì¦ìˆ˜í–‰ > ì¸ì¦ ì„±ê³µì´ë©´ kongì—ì„œ Backend Service í˜¸ì¶œ
```
> ##ìµœì¢…ì •ë¦¬
> 
> ğŸ”¹ íšŒì›ê°€ì… ì‹œ
> 
>âœ… client_id, client_secretì„ ìƒì„±í•˜ì—¬ DBì— ì €ì¥
> 
>âœ… ì‚¬ìš©ìëŠ” ì´ë¥¼ ì§ì ‘ ì•Œ í•„ìš” ì—†ìŒ
> 
>
>ğŸ”¹ ë¡œê·¸ì¸ ì‹œ
> 
>âœ… ì‚¬ìš©ìëŠ” ì¼ë°˜ ë¡œê·¸ì¸ (username + password) ìš”ì²­
> 
>âœ… ë°±ì—”ë“œì—ì„œ client_idë¥¼ DBì—ì„œ ì¡°íšŒ í›„, OAuth ì¸ì¦ ìš”ì²­ì— ìë™ í¬í•¨
> 
>âœ… ì´í›„ì˜ OAuth ì¸ì¦ ì ˆì°¨(Authorization Code ë°œê¸‰ â†’ Access Token ìš”ì²­)ëŠ” ê¸°ì¡´ê³¼ ë™ì¼
> 


